<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Authentication Setup for Nettskjema API • nettskjemar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authentication Setup for Nettskjema API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nettskjemar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/nettskjemar.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Working with data</h6></li>
    <li><a class="dropdown-item" href="../articles/nettskjemar.html">Retrieving all form submissions</a></li>
    <li><a class="dropdown-item" href="../articles/labelled_data.html">Labelled data</a></li>
    <li><a class="dropdown-item" href="../articles/submissions.html">Single submissions</a></li>
    <li><a class="dropdown-item" href="../articles/attachments.html">Retrieving attachments</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>User auth and information</h6></li>
    <li><a class="dropdown-item" href="../articles/authentication.html">Authentication setup</a></li>
    <li><a class="dropdown-item" href="../articles/forms.html">Viewing all forms</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other requests</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Retrieving form meta-data</a></li>
    <li><a class="dropdown-item" href="../articles/custom_requests.html">Running custom requests</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/capro-uio/nettskjemar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Authentication Setup for Nettskjema API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/capro-uio/nettskjemar/blob/main/vignettes/authentication.Rmd" class="external-link"><code>vignettes/authentication.Rmd</code></a></small>
      <div class="d-none name"><code>authentication.Rmd</code></div>
    </div>

    
    
<p>This vignette explains how to set up authentication with the
Nettskjema API using the <code>ns_req</code> and
<code>ns_auth_token</code> functions provided in the package.
Authentication is required to connect to the API endpoints and perform
operations.</p>
<div class="section level2">
<h2 id="setting-up-authentication">Setting Up Authentication<a class="anchor" aria-label="anchor" href="#setting-up-authentication"></a>
</h2>
<div class="section level3">
<h3 id="setting-up-a-client">Setting up a client<a class="anchor" aria-label="anchor" href="#setting-up-a-client"></a>
</h3>
<p>Before using the functions, you need the following: 1. <strong>A
registered API client</strong> in Nettskjema. 2. <strong>Your client
credentials</strong> (client ID and client secret). These are provided
when you register the client.</p>
<p>To register a client go to the <a href="https://authorization.nettskjema.no/" class="external-link">nettskjema authorization
portal</a> or use the <code><a href="../reference/ns_create_client.html">ns_create_client()</a></code> function to open
the url. Here you will be asked to log in with your user account, so you
can create the client.</p>
</div>
<div class="section level3">
<h3 id="add-credentials-to-your--renviron-file">Add Credentials to Your <code>.Renviron</code> File<a class="anchor" aria-label="anchor" href="#add-credentials-to-your--renviron-file"></a>
</h3>
<p>To prevent hardcoding your credentials in your scripts, add the
following entries to your <code>.Renviron</code> file. The
<code>.Renviron</code> file is a hidden file in your home directory that
R reads on startup.</p>
<ol style="list-style-type: decimal">
<li>Open your <code>.Renviron</code> file. You can create or edit it
with:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_expand.html" class="external-link">path_home</a></span><span class="op">(</span><span class="st">".Renviron"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Add your credentials:</li>
</ol>
<pre><code><span><span class="va">NETTSKJEMA_CLIENT_ID</span><span class="op">=</span><span class="va">your_client_id</span></span>
<span><span class="va">NETTSKJEMA_CLIENT_SECRET</span><span class="op">=</span><span class="va">your_client_secret</span></span></code></pre>
<p>Replace <code>your_client_id</code> and
<code>your_client_secret</code> with the actual values you received from
Nettskjema.</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Save and close the file.</p></li>
<li><p>Restart your R session to the load changes.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="retrieve-the-access-token">Retrieve the Access Token<a class="anchor" aria-label="anchor" href="#retrieve-the-access-token"></a>
</h3>
<p>Use the <code>ns_auth_token</code> function to retrieve your access
token. This function exchanges your client credentials for a valid
token. The token is cached by default for efficiency.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CAPRO-UiO/nettskjemar" class="external-link">nettskjemar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Try getting your user information</span></span>
<span><span class="fu"><a href="../reference/ns_get_me.html">ns_get_me</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $isPersonalDataResponsible</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $displayName</span></span>
<span><span class="co">#&gt; [1] "ccda25ce-8256-4c6f-ba71-7a4357dc6caf@apiclient"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $logoutLink</span></span>
<span><span class="co">#&gt; [1] "/signout"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isSuperUser</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isAuthenticated</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $userType</span></span>
<span><span class="co">#&gt; [1] "UNKNOWN_ROLE"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $hasAcceptedTos</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isSupportUser</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isAdministrativeUser</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isInLdapGroupUioTils</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>If this returns a data.frame of all the forms this client has access
to.</p>
<p>By default, the token is stored in your home directory as
<code>.nettskjema_token.rds</code> with a 24-hour validity period (max
validity of a token). The token is automatically refreshed after the
24–hour period is over, and you as a user should not even notice that
this happens.</p>
<p>You can configure the caching path using the <code>cache_path</code>
argument of the function, if you are comfortable doing that.</p>
</div>
<div class="section level3">
<h3 id="accessing-forms">Accessing forms<a class="anchor" aria-label="anchor" href="#accessing-forms"></a>
</h3>
<p>To access forms, you need to add the client to each form you want it
to have access to. This is similar to the procedures necessary in api
v2, for those who had experience with that.</p>
<div class="float">
<img src="static/client_overview.png" alt="Screenshot of the Nettskjema Authorization portal. There is a table with “My clients”, with the header row: Client Id, Username, Client Name, Created and Expires, with three dots at the end for more options. The client id is a SHA hash, and the username is the same SHA has appended with @apiclient."><div class="figcaption">Screenshot of the Nettskjema Authorization
portal. There is a table with “My clients”, with the header row: Client
Id, Username, Client Name, Created and Expires, with three dots at the
end for more options. The client id is a SHA hash, and the username is
the same SHA has appended with <span class="citation">@apiclient</span>.</div>
</div>
<p>You will need to go to each Nettskjema forms
<code>Settings -&gt; Permissions -&gt; Editing permissions</code> and
add the client id in the username format
<code>&lt;cliendId&gt;@apiclient</code> to every form you want this
specific client to have access to.</p>
<p>This means you can create custom clients with specific user access to
particular forms, rather than having a single client with overall access
to everything you have access to. While this creates an initial burden
of set up, it also allows more control and granularity for security.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-the-client">Working with the client<a class="anchor" aria-label="anchor" href="#working-with-the-client"></a>
</h2>
<p>The clients you set up are <em>not</em> user-centered. That means
they are intended to be shared with trusted collaborators you want to
also access you form through the API. While it is important to keep the
client secret an actual secret, it is a secret you <em>can</em> share
with those you trust to have API access. This makes it possible for
teams to work efficiently with the API collaboratively, without the need
for each individual to make a client.</p>
<p><strong>Note that</strong> sharing the client id and client secret
will not give any <em>user</em> access to forms in the nettskjema
portal, only access to the specific forms that one client has access to
<em>through the API</em>.</p>
<p>With that being said, here we have provided information about <a href="#add-credentials-to-your--renviron-file">adding the secret to you
<code>.Renviron</code> file</a>. Please note, that if you do this, you
should <strong>not by any means</strong> share this file openly. If you
and your team with with <code>git</code> for instance, this should
<strong>never</strong> be added to your git history.</p>
<p>If you by mistake share the secret with someone who should not have
access, or you only wanted to grant temporary access, the easiest way to
revoke the access, is to <a href="#renewing-the-client-secret">Renew the
client</a>. This will create a new client secret, and render the old
invalid.</p>
<div class="section level3">
<h3 id="renewing-the-client-secret">Renewing the client secret<a class="anchor" aria-label="anchor" href="#renewing-the-client-secret"></a>
</h3>
<p>The client is valid for one year, at which point you will need to
renew it for it to continue working. Renewing means getting a new
secret, not a whole new client, meaning the client will retain access to
all the forms you have added it to, and you won’t need to re-do that
part of the work.</p>
<p>To renew the client, go to the <a href="https://authorization.nettskjema.no/" class="external-link">authorization portal</a>,
and click the three dots next to the client you want to renew, and
choose “Renew”. You will then get a new secret, which you will need to
add to you .Renviron file, <a href="#add-credentials-to-your--renviron-file">like before</a>, by
replacing the one you already have there.</p>
</div>
<div class="section level3">
<h3 id="adding-colleagues">Adding colleagues<a class="anchor" aria-label="anchor" href="#adding-colleagues"></a>
</h3>
<p>You can give colleagues administrative access to the client by adding
them as an “Editor”. <strong>Note that</strong> adding someone as an
editor does not grant them direct access to forms through their user,
only to the credentials needed to access specific forms through the
API.</p>
<p>By having more editors to a client, means sharing the responsibility
of keeping the client up-to-date and renewing it when needed. This is
advised so that more people can act quickly if the secret has been
leaked by mistake by other team members. Having a couple of editors is a
good idea for redundancy, but make sure to limit to only necessary team
members.</p>
</div>
</div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Invalid Credentials</strong>: Ensure your client ID and
client secret are correct and have been properly registered in
Nettskjema.</li>
<li>
<strong>Token Expiry</strong>: Tokens are valid for 24 hours by
default. Re-run <code>ns_auth_token</code> to refresh the token, though
this should generally not be necessary, as it is run in the
background.</li>
<li>
<strong>Environment Variables Not Loaded</strong>: Ensure you’ve
added your credentials to <code>.Renviron</code> and restarted your R
session, the last part is necessary for R to access the new
information.</li>
</ol>
</div>
<div class="section level2">
<h2 id="more-information">More information<a class="anchor" aria-label="anchor" href="#more-information"></a>
</h2>
<p>More information about the client authentication can be found on the
<a href="https://www.uio.no/tjenester/it/adm-app/nettskjema/hjelp/api-clients-v3.md" class="external-link">UiO
webpages</a>.</p>
<p>You can find more information about the Nettskjema v3 API on the <a href="https://www.uio.no/tjenester/it/adm-app/nettskjema/hjelp/api-clients-v3.md" class="external-link">official
UiO documentation pages</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Athanasia Mo Mowinckel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
